require(["esri/Map","esri/views/MapView","esri/widgets/Locate","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/Graphic","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","esri/widgets/Popup","esri/layers/VectorTileLayer","calcite-maps/calcitemaps-v0.8","calcite-maps/calcitemaps-arcgis-support-v0.8","bootstrap/Collapse","bootstrap/Dropdown","bootstrap/Tab","@dojo/framework/shim/array","dojo/domReady!"],function(e,t,r,o,a,l,n,s,u,d,p,c,m,g,b){var f={Allston:[-71.1237912,42.3626648],Arboretum:[-71.1333697,42.295822],Cambridge:[-71.1168498,42.3759086],Longwood:[-71.1024294,42.3389915],Forest:[-72.190308,42.5313531]},v="https://prodsmap.cadm.harvard.edu/images/root_images/",y=(new m({url:"https://www.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json"}),{title:"{buildingroomname}"}),h=new o({url:"https://prodtmap.cadm.harvard.edu/server/rest/services/Hosted/lactationroom04132020/FeatureServer",outFields:["*"],visible:!0,renderer:new n({symbol:new u({color:[0,121,193,.5],style:"solid",outline:{width:1.2,color:"blue"}})})}),w=new a,_=new t({container:"mapViewDiv",map:new e({basemap:"topo",layers:[h,w]}),center:[-71.116076,42.358],zoom:14,padding:{top:50,bottom:0},breakpoints:{xsmall:768,small:769,medium:992,large:1200}});h.popupTemplate=y,_.constraints={rotationEnabled:!1},_.popup.dockOptions={position:"bottom-left"};var A=new r({view:_});_.ui.add(A,{position:"top-left"}),_.on("click",function(e){e.stopPropagation(),document.getElementById("infoBuildings").options[0].selected=!0;var t=e.screenPoint;_.popup.location=e.mapPoint,_.popup.visible=!0,_.hitTest(t).then(E)});var R=document.createElement("a"),T=document.createTextNode("Reserve through RoomBook");function E(e){w.popupTemplate=y,w.removeAll();var t=e.results[0].graphic.attributes,i=(t.Primary_Building_Name,document.getElementById("infoBuildings"),new l({geometry:e.results[0].graphic.geometry,symbol:new u({color:[255,0,0,.4],style:"solid",outline:{color:"red",width:2}})}));w.add(i);var r=t.image,o=document.createElement("a"),a=document.createTextNode("Lactation Support");o.setAttribute("href",t.firsttime),o.target="_blank",o.appendChild(a);t.firsttime,t.alreadyregistered;var n=t.privatespaces,s=t.reservationonly,d=t.drop_in,p=t.dooraccess,c=t.pump,m=t.sink,g=t.refrigerator,b=t.notes;if("02845.jpg"==r||"02805.jpg"==r||"02121.jpg"==r||"06318.jpg"==r||"02124.jpg"==r||"01208.jpg"==r)var f="<ul><li>First Time Registration: "+o.outerHTML+"</li><li>Already Registered: "+R.outerHTML+"</li><li>Private Space: "+n+"</li><li>Reservation Online: "+s+"</li><li>Drop In: "+d+"</li><li>Door Access: "+p+"</li><li>Pump Medela: "+c+"</li><li>Sink: "+m+"</li><li>Refrigerator: "+g+"</li><li>Additional Notes: "+b+"</li></ul>";else{var h=document.createElement("img"),A=v+r;h.src=A,h.alt=t.primary_building_name+" building image";f=h.outerHTML+"<p><ul><li>First Time Registration: "+o.outerHTML+"</li><li>Already Registered: "+R.outerHTML+"</li><li>Private Space: "+n+"</li><li>Reservation Online: "+s+"</li><li>Drop In: "+d+"</li><li>Door Access: "+p+"</li><li>Pump Medela: "+c+"</li><li>Sink: "+m+"</li><li>Refrigerator: "+g+"</li><li>Additional Notes: "+b+"</li></ul></p>"}_.popup.open({title:t.primary_building_name,content:f}),_.popup.focus()}R.setAttribute("href","https://roombook.harvard.edu/"),R.target="_blank",R.appendChild(T);var L=document.getElementById("infoRegions"),S=document.getElementById("infoBuildings");function M(e){var t=document.getElementById("infoBuildings"),i=e.features;for(var r in i){var o=document.createElement("option");o.text=i[r].attributes.primary_building_name,o.value=i[r].attributes.primary_building_name,t.add(o)}}L.addEventListener("change",function(){var e=L.options[L.selectedIndex].value;for(i=1;i<S.length;i++)S.remove(i),i--;if(1==S.length){var t=document.getElementById("infoBuildings"),r=document.createElement("option");r.text="Select a buildings...",r.setAttribute("selected",!0),r.setAttribute("disabled",!0),r.setAttribute("hidden",!0),t.add(r),console.log(S.length)}const o=Object.entries(f);for(const t of o)t[0]==e&&(_.center=t[1],_.zoom=16,(a=e,l=void 0,l=h.createQuery(),l.where="region = '"+a+"'",l.orderByFields=["primary_building_name ASC"],h.queryFeatures(l)).then(M));var a,l});var j=document.getElementById("infoBuildings");function k(e){w.removeAll();var t=e.features.map(function(e){return e.symbol=new u({color:[255,0,0,.4],style:"solid",outline:{color:"red",width:2}}),e}),i=(document.createElement("ul"),e.features[0].attributes,document.createElement("a")),r=document.createTextNode("Lactation Support");i.setAttribute("href",e.features[0].attributes.firsttime),i.target="_blank",i.appendChild(r);e.features[0].attributes.alreadyregistered;var o=e.features[0].attributes.privatespaces,a=e.features[0].attributes.reservationonly,l=e.features[0].attributes.drop_in,n=e.features[0].attributes.dooraccess,s=e.features[0].attributes.pump,d=e.features[0].attributes.sink,p=e.features[0].attributes.refrigerator,c=e.features[0].attributes.notes,m=e.features[0].attributes.image;if("02845.jpg"==m||"02805.jpg"==m||"02121.jpg"==m||"06318.jpg"==m||"02124.jpg"==m||"01208.jpg"==m)var g="<ul><li>First Time Registration: "+i.outerHTML+"</li><li>Already Registered: "+R.outerHTML+"</li><li>Private Space: "+o+"</li><li>Reservation Online: "+a+"</li><li>Drop In: "+l+"</li><li>Door Access: "+n+"</li><li>Pump Medela: "+s+"</li><li>Sink: "+d+"</li><li>Refrigerator: "+p+"</li><li>Additional Notes: "+c+"</li></ul>";else{var b=document.createElement("img"),f=v+e.features[0].attributes.image;b.src=f,b.alt=e.features[0].attributes.primary_building_name+" building image";g=b.outerHTML+"<p><ul><li>First Time Registration: "+i.outerHTML+"</li><li>Already Registered: "+R.outerHTML+"</li><li>Private Space: "+o+"</li><li>Reservation Online: "+a+"</li><li>Drop In: "+l+"</li><li>Door Access: "+n+"</li><li>Pump Medela: "+s+"</li><li>Sink: "+d+"</li><li>Refrigerator: "+p+"</li><li>Additional Notes: "+c+"</li></ul></p>"}_.center=[e.features[0].geometry.centroid.longitude,e.features[0].geometry.centroid.latitude],console.log(_.center),_.popup.open({title:e.features[0].attributes.primary_building_name,content:g,collapseEnabled:!1,location:_.center}),_.popup.focus(),w.addMany(t)}j.addEventListener("change",function(){var e,t,i=j.options[j.selectedIndex].value;console.log(i),(e=i,t=h.createQuery(),t.where="primary_building_name = '"+e+"'",t.outSpatialReference=4326,h.queryFeatures(t)).then(k),_.popup.visible=!0})});